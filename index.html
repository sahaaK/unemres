<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYLEAD Data Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c0a1a 0%, #1a0c2e 50%, #2d0b3a 100%);
            min-height: 100vh;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(45, 27, 105, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .glass-card:hover {
            border: 1px solid rgba(139, 92, 246, 0.4);
            box-shadow: 0 12px 40px rgba(139, 92, 246, 0.25);
        }
        
        .progress-glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #8b5cf6, #ec4899, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .stats-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .stats-card:hover::before {
            left: 100%;
        }
        
        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.4);
        }
        
        .filter-btn {
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.3));
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table th {
            background: rgba(76, 29, 149, 0.3);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .data-table tr:hover {
            background: rgba(139, 92, 246, 0.1);
        }
        
        .pagination-btn {
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover {
            background: rgba(139, 92, 246, 0.2);
        }
        
        .pagination-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Floating Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-32 h-32 rounded-full bg-purple-500 opacity-10 floating-element" style="animation-delay: 0s;"></div>
        <div class="absolute top-1/3 right-20 w-40 h-40 rounded-full bg-pink-500 opacity-10 floating-element" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/4 left-1/4 w-36 h-36 rounded-full bg-indigo-500 opacity-10 floating-element" style="animation-delay: 4s;"></div>
        <div class="absolute top-1/2 left-1/2 w-24 h-24 rounded-full bg-yellow-500 opacity-10 floating-element" style="animation-delay: 1s;"></div>
    </div>

    <!-- Header -->
    <header class="relative py-8" data-aos="fade-down">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center">
                    <img src="https://sylead-surveys.netlify.app/logo.png" alt="SYLEAD Logo" class="h-12 md:h-16 mr-4">
                    <h1 class="text-2xl md:text-3xl font-bold gradient-text">UNEMPLOYMENT RESULTS</h1>
                </div>
                <div class="glass-card px-4 py-2 rounded-lg">
                    <span class="text-sm text-gray-300">Total: </span>
                    <span id="total-responses" class="text-purple-400 font-bold">0</span>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="glass-card rounded-xl p-6 mb-6">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="filter" class="w-6 h-6 text-purple-400 mr-2"></i>
                    Filter Data
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">Gender</label>
                        <select id="gender-filter" class="filter-btn w-full px-4 py-2 rounded-lg text-white">
                            <option value="all">All Genders</option>
                            <option value="Lab">Male</option>
                            <option value="Dhedig">Female</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">Age</label>
                        <select id="age-filter" class="filter-btn w-full px-4 py-2 rounded-lg text-white">
                            <option value="all">All Ages</option>
                            <option value="18-21">18-21 years</option>
                            <option value="22-25">22-25 years</option>
                            <option value="26-30">26-30 years</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">Faculty</label>
                        <select id="faculty-filter" class="filter-btn w-full px-4 py-2 rounded-lg text-white">
                            <option value="all">All Faculties</option>
                            <option value="Social science and law">Social Science & Law</option>
                            <option value="Business and commerce">Business & Commerce</option>
                            <option value="Engineering and technology">Engineering & Technology</option>
                            <option value="Health and medicine">Health & Medicine</option>
                            <option value="Education/sharia">Education/Sharia</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">Employment</label>
                        <select id="employment-filter" class="filter-btn w-full px-4 py-2 rounded-lg text-white">
                            <option value="all">All Status</option>
                            <option value="Full time">Full Time</option>
                            <option value="Part time">Part Time</option>
                            <option value="No">Unemployed</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="apply-filters" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg font-medium">
                        Apply Filters
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="container mx-auto px-4 pb-12">
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stats-card glass-card rounded-xl p-6 text-center" data-aos="fade-up">
                <div class="inline-block p-3 bg-purple-500/20 rounded-full mb-4">
                    <i data-feather="users" class="w-8 h-8 text-purple-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-white mb-2">Total Respondents</h3>
                <p id="metric-total" class="text-3xl font-bold gradient-text">0</p>
            </div>
            
            <div class="stats-card glass-card rounded-xl p-6 text-center" data-aos="fade-up" data-aos-delay="100">
                <div class="inline-block p-3 bg-pink-500/20 rounded-full mb-4">
                    <i data-feather="briefcase" class="w-8 h-8 text-pink-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-white mb-2">Employment Rate</h3>
                <p id="metric-employment" class="text-3xl font-bold gradient-text">0%</p>
            </div>
            
            <div class="stats-card glass-card rounded-xl p-6 text-center" data-aos="fade-up" data-aos-delay="200">
                <div class="inline-block p-3 bg-indigo-500/20 rounded-full mb-4">
                    <i data-feather="globe" class="w-8 h-8 text-indigo-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-white mb-2">Want to Emigrate</h3>
                <p id="metric-emigration" class="text-3xl font-bold gradient-text">0%</p>
            </div>
            
            <div class="stats-card glass-card rounded-xl p-6 text-center" data-aos="fade-up" data-aos-delay="300">
                <div class="inline-block p-3 bg-yellow-500/20 rounded-full mb-4">
                    <i data-feather="trending-up" class="w-8 h-8 text-yellow-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-white mb-2">Optimistic Future</h3>
                <p id="metric-optimism" class="text-3xl font-bold gradient-text">0%</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Gender Distribution -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="user" class="w-6 h-6 text-purple-400 mr-2"></i>
                    Gender Distribution
                </h2>
                <div class="chart-container">
                    <canvas id="gender-chart"></canvas>
                </div>
            </div>
            
            <!-- Employment Status -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up" data-aos-delay="100">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="briefcase" class="w-6 h-6 text-pink-400 mr-2"></i>
                    Employment Status
                </h2>
                <div class="chart-container">
                    <canvas id="employment-chart"></canvas>
                </div>
            </div>
            
            <!-- Emigration Intent -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up" data-aos-delay="200">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="globe" class="w-6 h-6 text-indigo-400 mr-2"></i>
                    Emigration Intent
                </h2>
                <div class="chart-container">
                    <canvas id="emigration-chart"></canvas>
                </div>
            </div>
            
            <!-- Future Outlook -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up" data-aos-delay="300">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="trending-up" class="w-6 h-6 text-yellow-400 mr-2"></i>
                    Future Outlook
                </h2>
                <div class="chart-container">
                    <canvas id="outlook-chart"></canvas>
                </div>
            </div>
            
            <!-- Faculty Distribution -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up" data-aos-delay="400">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="book" class="w-6 h-6 text-green-400 mr-2"></i>
                    Faculty Distribution
                </h2>
                <div class="chart-container">
                    <canvas id="faculty-chart"></canvas>
                </div>
            </div>
            
            <!-- Confidence in Finding Job -->
            <div class="glass-card rounded-xl p-6" data-aos="fade-up" data-aos-delay="500">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                    <i data-feather="target" class="w-6 h-6 text-blue-400 mr-2"></i>
                    Job Confidence
                </h2>
                <div class="chart-container">
                    <canvas id="confidence-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="glass-card rounded-xl p-6 mb-8" data-aos="fade-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i data-feather="database" class="w-6 h-6 text-purple-400 mr-2"></i>
                    Response Data
                </h2>
                <div class="flex items-center">
                    <span class="text-sm text-gray-300 mr-3">Show</span>
                    <select id="rows-per-page" class="filter-btn px-3 py-1 rounded-lg text-white">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-300 ml-3">entries</span>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="data-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Faculty</th>
                            <th>Employment</th>
                            <th>Emigration</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
            
            <div class="flex justify-between items-center mt-6">
                <div class="text-sm text-gray-300" id="table-info">
                    Showing 0 to 0 of 0 entries
                </div>
                <div class="flex space-x-2" id="pagination">
                    <!-- Pagination will be generated here -->
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="glass-card rounded-xl p-6 text-center" data-aos="fade-up">
            <h2 class="text-xl font-bold text-white mb-4">Export Data</h2>
            <p class="text-gray-300 mb-6">Download the complete dataset for further analysis</p>
            <div class="flex justify-center space-x-4">
                <button id="export-csv" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-lg font-medium">
                    <i data-feather="download" class="w-5 h-5 inline mr-2"></i>
                    Export CSV
                </button>
                <button id="export-json" class="bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-3 rounded-lg font-medium">
                    <i data-feather="download" class="w-5 h-5 inline mr-2"></i>
                    Export JSON
                </button>
            </div>
        </div>
    </main>

    <!-- Response Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="glass-card rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Response Details</h3>
                <button onclick="closeDetailModal()" class="text-gray-400 hover:text-white">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="modal-content" class="space-y-4">
                <!-- Content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBUc5hcM-aDwF3YqLkMrlGQ39aUKesAPwI",
            authDomain: "sylead-surveys.firebaseapp.com",
            projectId: "sylead-surveys",
            storageBucket: "sylead-surveys.firebasestorage.app",
            messagingSenderId: "1022858819367",
            appId: "1:1022858819367:web:819cc345a439ccb691db02",
            measurementId: "G-E9E04BWX5Y"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true
        });

        // Initialize Feather Icons
        feather.replace();

        // Global variables
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        let currentFilters = {
            gender: 'all',
            age: 'all',
            faculty: 'all',
            employment: 'all'
        };

        // Chart instances
        const charts = {
            gender: null,
            employment: null,
            emigration: null,
            outlook: null,
            faculty: null,
            confidence: null
        };

        // Fetch data from Firestore
        async function fetchData() {
            try {
                const snapshot = await db.collection('unemployment survey').get();
                allData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                filteredData = [...allData];
                
                updateMetrics();
                renderCharts();
                renderTable();
                setupEventListeners();
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Update metrics
        function updateMetrics() {
            document.getElementById('total-responses').textContent = allData.length;
            document.getElementById('metric-total').textContent = allData.length;
            
            // Employment rate
            const employed = allData.filter(item => item.employment !== 'No').length;
            const employmentRate = allData.length ? Math.round((employed / allData.length) * 100) : 0;
            document.getElementById('metric-employment').textContent = `${employmentRate}%`;
            
            // Emigration intent
            const wantToEmigrate = allData.filter(item => item.emigration === 'Yes').length;
            const emigrationRate = allData.length ? Math.round((wantToEmigrate / allData.length) * 100) : 0;
            document.getElementById('metric-emigration').textContent = `${emigrationRate}%`;
            
            // Optimism rate
            const optimistic = allData.filter(item => item.futureOutlook === 'Optimistic').length;
            const optimismRate = allData.length ? Math.round((optimistic / allData.length) * 100) : 0;
            document.getElementById('metric-optimism').textContent = `${optimismRate}%`;
        }

        // Render charts
        function renderCharts() {
            renderGenderChart();
            renderEmploymentChart();
            renderEmigrationChart();
            renderOutlookChart();
            renderFacultyChart();
            renderConfidenceChart();
        }

        function renderGenderChart() {
            const ctx = document.getElementById('gender-chart').getContext('2d');
            const maleCount = filteredData.filter(item => item.gender === 'Lab').length;
            const femaleCount = filteredData.filter(item => item.gender === 'Dhedig').length;
            
            if (charts.gender) charts.gender.destroy();
            
            charts.gender = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Male', 'Female'],
                    datasets: [{
                        data: [maleCount, femaleCount],
                        backgroundColor: ['#8b5cf6', '#ec4899'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderEmploymentChart() {
            const ctx = document.getElementById('employment-chart').getContext('2d');
            const fullTime = filteredData.filter(item => item.employment === 'Full time').length;
            const partTime = filteredData.filter(item => item.employment === 'Part time').length;
            const unemployed = filteredData.filter(item => item.employment === 'No').length;
            
            if (charts.employment) charts.employment.destroy();
            
            charts.employment = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Full Time', 'Part Time', 'Unemployed'],
                    datasets: [{
                        data: [fullTime, partTime, unemployed],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#e2e8f0'
                            },
                            grid: {
                                color: 'rgba(139, 92, 246, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e2e8f0'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderEmigrationChart() {
            const ctx = document.getElementById('emigration-chart').getContext('2d');
            const yes = filteredData.filter(item => item.emigration === 'Yes').length;
            const no = filteredData.filter(item => item.emigration === 'No').length;
            const notSure = filteredData.filter(item => item.emigration === 'Not sure').length;
            
            if (charts.emigration) charts.emigration.destroy();
            
            charts.emigration = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Yes', 'No', 'Not Sure'],
                    datasets: [{
                        data: [yes, no, notSure],
                        backgroundColor: ['#8b5cf6', '#ec4899', '#6b7280'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderOutlookChart() {
            const ctx = document.getElementById('outlook-chart').getContext('2d');
            const optimistic = filteredData.filter(item => item.futureOutlook === 'Optimistic').length;
            const neutral = filteredData.filter(item => item.futureOutlook === 'Neutral').length;
            const pessimistic = filteredData.filter(item => item.futureOutlook === 'Pessimistic').length;
            const notSure = filteredData.filter(item => item.futureOutlook === 'Not sure').length;
            
            if (charts.outlook) charts.outlook.destroy();
            
            charts.outlook = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Optimistic', 'Neutral', 'Pessimistic', 'Not Sure'],
                    datasets: [{
                        data: [optimistic, neutral, pessimistic, notSure],
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        borderColor: '#8b5cf6',
                        borderWidth: 2,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#8b5cf6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            ticks: {
                                display: false
                            },
                            grid: {
                                color: 'rgba(139, 92, 246, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(139, 92, 246, 0.1)'
                            },
                            pointLabels: {
                                color: '#e2e8f0',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderFacultyChart() {
            const ctx = document.getElementById('faculty-chart').getContext('2d');
            const faculties = [
                'Social science and law',
                'Business and commerce',
                'Engineering and technology',
                'Health and medicine',
                'Education/sharia',
                'Other'
            ];
            
            const facultyData = faculties.map(faculty => 
                filteredData.filter(item => item.faculty === faculty).length
            );
            
            if (charts.faculty) charts.faculty.destroy();
            
            charts.faculty = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: faculties.map(f => f.split(' ')[0]),
                    datasets: [{
                        data: facultyData,
                        backgroundColor: [
                            '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#3b82f6', '#6b7280'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderConfidenceChart() {
            const ctx = document.getElementById('confidence-chart').getContext('2d');
            const veryConfident = filteredData.filter(item => item.confidence === 'Very confident').length;
            const somewhat = filteredData.filter(item => item.confidence === 'Somewhat confident').length;
            const notConfident = filteredData.filter(item => item.confidence === 'Not confident').length;
            const notSure = filteredData.filter(item => item.confidence === 'Not sure').length;
            
            if (charts.confidence) charts.confidence.destroy();
            
            charts.confidence = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Very Confident', 'Somewhat', 'Not Confident', 'Not Sure'],
                    datasets: [{
                        data: [veryConfident, somewhat, notConfident, notSure],
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        borderColor: '#8b5cf6',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#fff',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#e2e8f0'
                            },
                            grid: {
                                color: 'rgba(139, 92, 246, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e2e8f0'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Render data table
        function renderTable() {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, filteredData.length);
            const pageData = filteredData.slice(startIndex, endIndex);
            
            pageData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                    <td>${item.gender || 'N/A'}</td>
                    <td>${item.age || 'N/A'}</td>
                    <td>${item.faculty || 'N/A'}</td>
                    <td>${item.employment || 'N/A'}</td>
                    <td>${item.emigration || 'N/A'}</td>
                    <td>
                        <div class="flex items-center space-x-2">
                            <button onclick="viewDetails('${item.id}')" class="text-purple-400 hover:text-purple-300" title="View details">
                                <i data-feather="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteResult('${item.id}')" class="text-red-400 hover:text-red-300" title="Delete result">
                                <i data-feather="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            feather.replace();
            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';
            
            // Previous button
            const prevButton = document.createElement('button');
            prevButton.className = 'pagination-btn';
            prevButton.innerHTML = '<i data-feather="chevron-left" class="w-4 h-4"></i>';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            };
            paginationContainer.appendChild(prevButton);
            
            // Page buttons
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.onclick = () => {
                    currentPage = i;
                    renderTable();
                };
                paginationContainer.appendChild(pageButton);
            }
            
            // Next button
            const nextButton = document.createElement('button');
            nextButton.className = 'pagination-btn';
            nextButton.innerHTML = '<i data-feather="chevron-right" class="w-4 h-4"></i>';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            };
            paginationContainer.appendChild(nextButton);
            
            // Update table info
            const startIndex = (currentPage - 1) * rowsPerPage + 1;
            const endIndex = Math.min(currentPage * rowsPerPage, filteredData.length);
            document.getElementById('table-info').textContent = 
                `Showing ${startIndex} to ${endIndex} of ${filteredData.length} entries`;
        }

        // View response details
        function viewDetails(id) {
            const item = allData.find(d => d.id === id);
            if (!item) return;
            
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-purple-400 font-semibold mb-2">Personal Information</h4>
                        <p><span class="text-gray-400">Gender:</span> ${item.gender || 'N/A'}</p>
                        <p><span class="text-gray-400">Age:</span> ${item.age || 'N/A'}</p>
                        <p><span class="text-gray-400">Year:</span> ${item.year || 'N/A'}</p>
                        <p><span class="text-gray-400">Faculty:</span> ${item.faculty || 'N/A'}</p>
                    </div>
                    <div>
                        <h4 class="text-purple-400 font-semibold mb-2">Employment Status</h4>
                        <p><span class="text-gray-400">Employment:</span> ${item.employment || 'N/A'}</p>
                        <p><span class="text-gray-400">Job Search Duration:</span> ${item.jobSearchDuration || 'N/A'}</p>
                        <p><span class="text-gray-400">Unemployment Reason:</span> ${item.unemploymentReason || 'N/A'}</p>
                        <p><span class="text-gray-400">Confidence:</span> ${item.confidence || 'N/A'}</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-purple-400 font-semibold mb-2">Emigration</h4>
                        <p><span class="text-gray-400">Want to Emigrate:</span> ${item.emigration || 'N/A'}</p>
                        <p><span class="text-gray-400">Emigration Reason:</span> ${item.emigrationReason || 'N/A'}</p>
                        <p><span class="text-gray-400">Destination:</span> ${item.destination || 'N/A'}</p>
                        <p><span class="text-gray-400">Return Home:</span> ${item.returnHome || 'N/A'}</p>
                    </div>
                    <div>
                        <h4 class="text-purple-400 font-semibold mb-2">University & Government</h4>
                        <p><span class="text-gray-400">University Support:</span> ${item.universitySupport || 'N/A'}</p>
                        <p><span class="text-gray-400">University Action:</span> ${item.universityAction || 'N/A'}</p>
                        <p><span class="text-gray-400">Government Policy:</span> ${item.governmentPolicy || 'N/A'}</p>
                        <p><span class="text-gray-400">SYLEAD Program:</span> ${item.syleadProgram || 'N/A'}</p>
                    </div>
                </div>
                <div>
                    <h4 class="text-purple-400 font-semibold mb-2">Future Outlook</h4>
                    <p><span class="text-gray-400">Future Outlook:</span> ${item.futureOutlook || 'N/A'}</p>
                    <p><span class="text-gray-400">Want to Emigrate:</span> ${item.wantToEmigrate || 'N/A'}</p>
                    <p><span class="text-gray-400">Comments:</span> ${item.comments || 'N/A'}</p>
                </div>
            `;
            
            document.getElementById('detailModal').classList.remove('hidden');
            document.getElementById('detailModal').classList.add('flex');
            feather.replace();
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
            document.getElementById('detailModal').classList.remove('flex');
        }

        // Apply filters
        function applyFilters() {
            filteredData = allData.filter(item => {
                if (currentFilters.gender !== 'all' && item.gender !== currentFilters.gender) return false;
                if (currentFilters.age !== 'all' && item.age !== currentFilters.age) return false;
                if (currentFilters.faculty !== 'all' && item.faculty !== currentFilters.faculty) return false;
                if (currentFilters.employment !== 'all' && item.employment !== currentFilters.employment) return false;
                return true;
            });
            
            currentPage = 1;
            renderCharts();
            renderTable();
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('gender-filter').addEventListener('change', (e) => {
                currentFilters.gender = e.target.value;
            });
            
            document.getElementById('age-filter').addEventListener('change', (e) => {
                currentFilters.age = e.target.value;
            });
            
            document.getElementById('faculty-filter').addEventListener('change', (e) => {
                currentFilters.faculty = e.target.value;
            });
            
            document.getElementById('employment-filter').addEventListener('change', (e) => {
                currentFilters.employment = e.target.value;
            });
            
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            
            document.getElementById('rows-per-page').addEventListener('change', (e) => {
                rowsPerPage = parseInt(e.target.value);
                currentPage = 1;
                renderTable();
            });
            
            document.getElementById('export-csv').addEventListener('click', exportCSV);
            document.getElementById('export-json').addEventListener('click', exportJSON);
        }

        // Export functions
        function exportCSV() {
            const headers = [
                'Timestamp', 'Gender', 'Age', 'Year', 'Faculty', 'Employment', 
                'JobSearchDuration', 'UnemploymentReason', 'Confidence', 'BusinessIdea',
                'Emigration', 'EmigrationReason', 'Destination', 'ReturnHome', 
                'EmigrationImpact', 'UniversitySupport', 'UniversityAction', 
                'GovernmentPolicy', 'SyleadProgram', 'FutureOutlook', 'WantToEmigrate', 'Comments'
            ];
            
            let csvContent = headers.join(',') + '\n';
            
            allData.forEach(item => {
                const row = headers.map(header => {
                    const value = item[header.toLowerCase()] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'sylead_survey_data.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportJSON() {
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'sylead_survey_data.json');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Delete a result by id
        async function deleteResult(id) {
            if (!id) return;
            const confirmDelete = confirm('Are you sure you want to delete this result? This action cannot be undone.');
            if (!confirmDelete) return;

            try {
                // Delete from Firestore
                await db.collection('unemployment survey').doc(id).delete();

                // Remove from local arrays
                allData = allData.filter(item => item.id !== id);
                filteredData = filteredData.filter(item => item.id !== id);

                // Update UI
                updateMetrics();
                renderCharts();
                // Ensure currentPage is valid
                const totalPages = Math.max(1, Math.ceil(filteredData.length / rowsPerPage));
                if (currentPage > totalPages) currentPage = totalPages;
                renderTable();

                alert('Result deleted successfully.');
            } catch (error) {
                console.error('Error deleting result:', error);
                alert('Failed to delete result. Check console for details.');
            }
        }

        // Initialize
        fetchData();
    </script>
</body>
</html>
